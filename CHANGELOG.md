# v1.5.1 更新日志

## 🐛 修复

### 汇率持久化与历史存储
- 将美元兑人民币数据改为写入 `data_handler` 新增的 `exchange_rate_history` 表
- 支持按日期查询、读取最近有效汇率、查询汇率历史，便于后续功能做历史回溯
- 数据库 schema 升级到 `v5`

### 汇率回退策略优化
- 当天汇率抓取失败时，优先回退最近一次有效汇率（自动或手动来源均可）
- 行情输出补充汇率日期与“今日汇率可能已变化”风险提示
- `更新今日汇率` 写入历史表后立即生效

# v1.5.0 更新日志

## 🚀 新功能

### 贵金属行情重构（当前仅黄金）
- 将指令由 `今日行情` 调整为 `贵金属行情`
- 行情范围调整为“当前版本仅提供黄金查询”
- 新增 `更新今日汇率 <1美元兑人民币>` 指令，支持手动补充当日汇率

### COMEX 黄金数据源切换
- 黄金行情改为从东方财富页面 `https://quote.eastmoney.com/globalfuture/GC00Y.html` 抓取
- 使用 Playwright 获取 `zsquote3l zs_brief` 区块内 `brief_info_c` 表格数据
- 输出包含今开、最高、最低、涨跌额、涨跌幅、成交量、持仓量等关键字段

### 汇率与人民币换算
- 汇率来源改为 Google “美元兑人民币”查询结果
- 汇率改为“每天自动查询一次”并本地缓存，减少重复请求
- 当日未查到汇率时，明确提示用户通过 `更新今日汇率 <1美元兑人民币>` 手动补充
- 新增人民币换算：`COMEX黄金价格 * 美元兑人民币汇率 / 31.1035`，输出国内金价（元/克）

## 🔧 体验改进

- 行情返回结构调整为“先国内金价，再 COMEX 黄金详细数据”
- 新增汇率缓存持久化文件 `market_exchange_rate.json`
- 更新 `基金帮助` 中贵金属相关命令说明与示例

# v1.4.1 更新日志

## 🚀 新功能

### 新增基金持仓智能分析
- 新增 `基金持仓智能分析` 指令：针对发起用户当前持仓做组合级分析
- 报告包含总成本/总市值/总收益、仓位集中度、加权波动与回撤等关键指标
- 支持图像化输出（组合快照 + 持仓明细 + AI 解读），未配置 LLM 时自动回退量化结论
- 当用户没有持仓时，提示先补充基金持仓信息

### 新增实时持仓指令
- 新增 `sscc` 指令：按发起用户持仓批量查询基金现价
- 输出每只基金最近收盘日及对应涨跌幅
- 支持区分场内/场外基金并采用对应的数据获取路径

### QDII 查询优化
- 对 QDII 基金最近收盘数据增加当日复用缓存
- 同一自然日内重复查询时减少不必要的净值请求

## 🔧 体验改进

- 补充 `基金帮助` 与 `README` 的命令说明
- 增强持仓实时快照文本展示，明确场内/场外和 QDII 标记

# v1.1.0 更新日志

## 🚀 新功能

### 场外基金支持
- 新增对场外基金（如 ETF联接基金）的完整支持
- 支持场外基金实时估值查询
- 支持场外基金历史净值查询

### 数据接口优化
- 使用直接 HTTP API 调用替代 akshare 库
- 解决了 `Connection aborted` 和 `RemoteDisconnected` 连接错误
- 新增天天基金搜索 API，提升搜索稳定性

### 图片渲染改进
- 新增本地 Playwright 渲染器，提升图片清晰度
- 修复图片宽度不一致问题（右侧空白区域）
- 使用 2x 分辨率渲染，图片更清晰

## 📋 支持的基金类型

| 类型       | 代码示例 | 功能                |
| ---------- | -------- | ------------------- |
| 场内 LOF   | 161226   | 实时行情 + 历史K线  |
| 上交所 ETF | 518880   | 实时行情 + 历史K线  |
| 深交所 ETF | 159934   | 实时行情 + 历史K线  |
| 场外基金   | 004433   | 实时估值 + 历史净值 |

## 🔧 技术改进

- 新增 `eastmoney_api.py` 模块，封装东方财富 API
- 新增 `image_generator.py` 模块，本地图片渲染
- 优化请求重试机制，添加随机 User-Agent 轮换
- 修复 JSON MIME 类型解析问题

## 📦 依赖更新

- 新增 `jinja2>=3.0.0`
- 新增 `playwright>=1.40.0` (可选)
